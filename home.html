<HTML>
        <HEAD>
            <meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 
            <script type="text/javascript" src="scripts/lastfm.api.md5.js"></script>
            <script type="text/javascript" src="scripts/lastfm.api.js"></script>
            <script type="text/javascript" src="scripts/jquery-3.2.1.min.js"></script>      
           <TITLE>My Music Finder</TITLE>
            
            <link rel="stylesheet" href="design/deco.css" style="text/css">
        
            <h1 id="titolo">Benvenuti in...My Music Finder </h1>
            
        </HEAD>

        <BODY>
        <script type="text/javascript">
            $('div#id0').click(function() {
                console.log($('div#id0').html());
            })
        </script>
        
        <div id="id1">
           <br><a href="home.html" target= "_parent"><img src="mmflogo.png" width="150" height="140" id="logo"></a>
           <p id="sea"> Are you ready to search for some amazing artists?! Then search for them!</p>
            <br>
            <div id="id2">
            <!-- div in cui verrà mostrata la preview-->
            </div>
 
           <form name="lookArtistsForm" id="modulo" action="result.html" method="GET">
               <fieldset style="display: inline-block">
                   <legend>Search</legend>
                   
                   <input type="search" name="test" id="searchArtists" minlength="2" placeholder="Cosa stai cercando?" required >
                   <!--<img src="lupa.png">-->
                   <button id="premilo"><img src="lupa.png"></button>
                   <!--<button id="theButton">Try it</button> -->
                   <input type="reset" id="rese" value="Wrote Wrong">
                   <br><br>
                   <div id="testRadio">
                   <input id="artista" type="radio" name="ric" value="Artista" >Artista
                   <input id="brano" type="radio" name="ric" value="Brano" > Brano
                   <input id="album" type="radio" name="ric" value="Album"  >Album<br>
                   <br>
                </div>
               </fieldset>
            </form><br>
           </div>
           <hr id="separa">
            
            <div id="foot">   
                <p> &reg; My Music Finder</p> 
            </div>
            <br>
            <div id="copia" style="text-align:center; ">
                    <marquee behavior= "alternate" direction="left" scrollamount="10" onmouseover="stop()"onmouseout="start()" height="36"               width="512" > 
                    <span runat="server" ID="credits" style="width:3000px ;">© Kevin Velasco &amp; Giammarco Forcella 2017</span></marquee>
            </div>
            
           <script type="text/javascript">


           </script>

           <script type="text/javascript">

           $('html').bind('keypress', function(e) {
               if(e.keyCode == 13) {
                   return false;
                }
            });

            $(document).on("click", " .testingClass", function() {
                var tmp = $(this).attr('id');
                var artist = tmp.split('-')[0];
                var toSearch = tmp.split('-')[1];
                alert("The artist is " + artist + " and the album or track is " + toSearch);
                localStorage.artist = artist;
                localStorage.thingToLook = toSearch;
            });


            $('#testRadio').click(function(){

                if ($('#searchArtists').val() === "") {
                    alert("Inserisci un valore nella barra di ricerca");
                    return false;
                }

                var chooser = $("#testRadio input[type='radio']:checked").val();
                var argToSearch = $('#searchArtists').val();
                switch (chooser) {
                    case "Album":
                        proposeAlbum(argToSearch);
                        break;
                    case "Brano":
                        proposeTrack(argToSearch);
                        break;
                    default:
                        break;
                }

                $('form').attr('action', $("#testRadio input[type='radio']:checked").val() + ".html")
 
            })
           
           </script>

           <script type="text/javascript">
                $('input#rese').click( function() {
                    $('div#id2').empty();
                    $('div#id2').html('<p id="title" style="align-content: center;"></p>');
                });

                $('input[name=ric]').click(function() {
                    $('div#id2').empty();
                    $('div#id2').html('<p id="title" style="align-content: center;"></p>');
                })
           </script>

           <script type="text/javascript">
                var lastfm = new LastFM({
                    apiKey    : '007bb7dc4b7d8eef22dddd17427dc720',
                    apiSecret : '341b8690cb2f80336f49ba5bae9b5b69' ,
                    cache     : null
                });
           

                function proposeTrack(trackOfInterest) {
                    lastfm.track.search(
                        {track:trackOfInterest},
                        {success: function(data) {
                            console.log(data);
                            $tracks = data.results.trackmatches.track;
                            for(var i = 0; i < 10; i++) {
                                if (i == 4) {
                                    $('div#id2').append("<a href='Brano.html'><img src='" + $tracks[4]['image'][3]['#text'] + "' class='testingClass' id='" + $tracks[4]['artist'] + "-" + $tracks[4]['name'] + "' style=' width: 15%; margin-bottom: 0.5em;'></a><br>");
                                } else {
                                    $('div#id2').append("<a href='Brano.html'><img src='" + $tracks[i]['image'][3]['#text'] + "' class='testingClass' id='" + $tracks[i]['artist'] + "-" + $tracks[i]['name'] + "' style=' width: 15%; margin-bottom: 0.5em;'></a>");
                                }
                            }
                        } },
                        {error: function(code, message) {
                            console.log("Oh no!");
                        }
                        });
                }
           </script>

           <script type="text/javascript">
                                      var lastfm = new LastFM({
                               apiKey    : '007bb7dc4b7d8eef22dddd17427dc720',
                               apiSecret : '341b8690cb2f80336f49ba5bae9b5b69' ,
                               cache     : null
                             });
                function proposeAlbum(albumOfInterest) {
                    lastfm.album.search(
                               {album: albumOfInterest},  // Passando come parametro 'test', gli sto dicendo di prendere quello che 
                               //l'input chiamato "test" (riga 13 di home.html) ha "catturato dall'utente".
                               // Se tutto va a buon fine, allora...
                               { success: function(data) {
                                   $("div#id2").show();
                                   console.log(data);
                                   $albums = data.results.albummatches.album;
                                   console.log($albums[0]['artist']);
                                   for (var i = 0; i < 10; i++) 
                                   {
                                    
                                    if (i==4)
                                    {
                                        $('div#id2').append("<a href='Album.html'><img src='" + $albums[4]['image'][3]['#text'] + "' class='testingClass' id='" + $albums[4]['artist'] + "-" + $albums[4]['name'] + "' style=' width: 15%; margin-bottom: 0.5em;'></a><br>");
                                    }
                                    else
                                    {   //<p id='" + $albums[i]['artist'] + "-" + $albums[i]['name'] + ">
                                        $('div#id2').append("<a href='Album.html'><img src='" + $albums[i]['image'][3]['#text'] + "' class='testingClass' id='" + $albums[i]['artist'] + "-" + $albums[i]['name'] + "' style=' width: 15%; margin-bottom: 0.5em;'></a>");
                                    }
                                   } 
                                   console.log($('div#id2').attr('name'));
                               }, 
                            // In caso di errore, si printa il messaggio di errore
                           error: function(code, message) {
                               console.log("Sono andato in errore");
                               $("p#description").html(message + "<br/> Maybe you typed it in a wrong way?");
                               console.log(message);
                               //Magari far tornare indietro alla home in caso di errore ed incollare il messaggio sotto la search
                           }});
                }       
           </script>           
        </BODY>
</HTML>